------

# 电池测试数据上传接口文档 (MES)

## 1. 接口概述

本接口用于 **通用数据采集器 (UniversalDataCollector)** 将电池包测试结果（包括过程数据、判定结果及测试参数）实时上传至 MES 系统。

- **当前版本**: v1.0
- **数据来源**: 自动测试设备 (ATE) CSV 结果文件 + `.tpld` 测试模板参数文件
- **数据融合**: 采集器会自动将 CSV 中的测试数据与模板中的规格参数（Limit）合并后上传。

## 2. 接口定义

| **项目**           | **说明**                                                     |
| ------------------ | ------------------------------------------------------------ |
| **接口地址 (URL)** | `http://{MES_IP}:{PORT}/api/upload` (示例: `http://127.0.0.1:8080/api/upload`) |
| **请求方式**       | `POST`                                                       |
| **请求格式**       | `application/json`                                           |
| **字符编码**       | `UTF-8`                                                      |

## 3. 请求参数说明

### 3.1 根节点字段 (基础信息)

| **字段名 (Key)** | **类型** | **必填** | **示例值**              | **说明**                 |
| ---------------- | -------- | -------- | ----------------------- | ------------------------ |
| **Barcode**      | String   | 是       | `"3256"`                | 电池包条码 / SN          |
| **TestTime**     | String   | 是       | `"2026-01-08T13:20:17"` | 测试时间 (ISO 8601 格式) |
| **Result**       | String   | 是       | `"NG"`                  | 综合判定结果 (OK/NG)     |
| **Template**     | String   | 是       | `"H-2p6s-61.tpld"`      | 使用的测试模板文件名     |
| **Operator**     | String   | 否       | `"001"`                 | 操作员 ID                |
| **ErrorMsg**     | String   | 否       | `"DCR<NG>: > 8.500..."` | 具体的错误/失败描述信息  |

### 3.2 根节点字段 (整包测试数据)

| **字段名 (Key)**   | **类型** | **说明**                                   |
| ------------------ | -------- | ------------------------------------------ |
| **V1** ~ **V4**    | Number   | 整包/模组电压采样值 (V)                    |
| **I1**, **I2**     | Number   | 测试电流值 (A)                             |
| **DCR1**, **DCR2** | Number   | 直流内阻测试结果 (mΩ)                      |
| **CellVMin**       | String   | 单体电压最小值 (含索引，如 `"2.9240(20)"`) |
| **CellVMax**       | String   | 单体电压最大值 (含索引，如 `"3.0089(22)"`) |
| **CellVDif**       | Number   | 最大压差 (mV)                              |

### 3.3 集合数据字段 (采样数组)

MES 需支持接收变长数组，用于存储所有电芯的采样数据。

| **字段名 (Key)**     | **类型**      | **示例值**              | **说明**                        |
| -------------------- | ------------- | ----------------------- | ------------------------------- |
| **CELL_V1** ~ **V4** | Array<Number> | `[3.4031, 3.4016, ...]` | 电芯电压采样列表 (对应不同工步) |
| **CELL_T1** ~ **T4** | Array<Number> | `[]`                    | 电芯温度采样列表                |

### 3.4 嵌套对象字段 (复杂结构)

**A. CELL_DCR (电芯内阻详情)**

| **父节点** | **字段名**    | **类型**      | **说明**               |
| ---------- | ------------- | ------------- | ---------------------- |
| `CELL_DCR` | **Cell_DCR1** | Array<Number> | 阶段1 所有电芯内阻列表 |
| `CELL_DCR` | **Cell_DCR2** | Array<Number> | 阶段2 所有电芯内阻列表 |

**B. Limit (规格参数 - 来自模板)**

*注意：此节点由采集器自动从模板文件解析并注入，用于追溯测试时的参数下限/上限。*

| **父节点** | **二级节点** | **字段名** | **类型** | **说明**                 |
| ---------- | ------------ | ---------- | -------- | ------------------------ |
| `Limit`    | `PackV`      | **Min**    | Number   | 整包电压下限 (如 `16.5`) |
| `Limit`    | `PackV`      | **Max**    | Number   | 整包电压上限 (如 `25.8`) |
| `Limit`    | `CellV`      | **Min**    | Number   | 单体电压下限             |
| `Limit`    | `CellV`      | **Max**    | Number   | 单体电压上限             |
| `Limit`    | `Diff`       | **Max**    | Number   | 允许最大压差             |
| `Limit`    | `Current`    | **Max**    | Number   | 保护电流上限             |

------

## 4. 请求报文示例 (Sample JSON)

JSON



```
{
    "Barcode": "3256",
    "TestTime": "2026-01-08T13:20:17",
    "Operator": "001",
    "Template": "H-2p6s-61.tpld",
    "Result": "NG",
    "ErrorMsg": "DCR<NG>: > 8.500 V_Cell_Dif<NG>: > 0.030",
    
    // 整包数据
    "V1": 20.3617,
    "V2": 17.8258,
    "V3": 19.036,
    "V4": 21.6048,
    "I1": -182.946,
    "I2": 182.965,
    "DCR1": 13.86,
    "DCR2": 14.04,
    "CellVMin": "2.9240(20)",
    "CellVMax": "3.0089(22)",
    "CellVDif": 84.9,

    // 电芯采样数组
    "CELL_V1": [3.4031, 3.4016, 3.4162, 3.3724, 3.4049, 3.4363],
    "CELL_V2": [2.9764, 2.9609, 2.9856, 2.924, 2.9701, 3.0089],
    "CELL_V3": [3.1858, 3.1862, 3.2058, 3.1587, 3.1914, 3.2259],
    "CELL_V4": [3.5865, 3.599, 3.6105, 3.5804, 3.6001, 3.6282],
    "CELL_T1": [],
    "CELL_T2": [],
    "CELL_T3": [],
    "CELL_T4": [],

    // 嵌套结构: 电芯内阻
    "CELL_DCR": {
        "Cell_DCR1": [2.0324, 2.1089, 2.0537, 2.151, 2.0767, 2.0362],
        "Cell_DCR2": [1.89, 1.9562, 1.9119, 2.0048, 1.9338, 1.8988]
    },

    // 嵌套结构: 模板规格参数 (动态解析注入)
    "Limit": {
        "PackV": {
            "Min": 16.5,
            "Max": 25.8
        },
        "Diff": {
            "Max": 30.0
        },
        "CellV": {
            "Min": 2.75,
            "Max": 4.3
        },
        "Current": {
            "Max": 190.0
        }
    }
}
```

## 5. 响应说明

MES 系统接收数据后，应返回以下 JSON 格式的响应：

JSON



```
{
    "code": 200,          // 200 表示成功，其他表示失败
    "message": "success", // 描述信息
    "data": null
}
```