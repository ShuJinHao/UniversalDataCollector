<Window x:Class="UniversalDataCollector.Views.MesSettingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="MES 接口与字段映射配置 (完整版)" Height="550" Width="700" WindowStartupLocation="CenterScreen">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <GroupBox Header="MES 服务器设置" Grid.Row="0" Padding="10">
            <StackPanel>
                <TextBlock Text="MES 上传接口地址 (URL):" Margin="0,0,0,5" />
                <TextBox Text="{Binding MesApiUrl}" Padding="5" />
            </StackPanel>
        </GroupBox>

        <GroupBox Header="字段映射配置 (CSV列 -> MES字段)" Grid.Row="1" Margin="0,15,0,0">
            <DataGrid ItemsSource="{Binding Mappings}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="True"
                      Margin="5"
                      RowHeight="30">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="MES字段名" Binding="{Binding MesFieldName}" Width="150" />

                    <DataGridTextColumn Header="CSV列索引" Binding="{Binding ColumnIndex}" Width="80" />

                    <DataGridComboBoxColumn Header="数据类型" SelectedItemBinding="{Binding DataType}" Width="100">
                        <DataGridComboBoxColumn.ItemsSource>
                            <x:Array Type="{x:Type sys:String}">
                                <sys:String>String</sys:String>
                                <sys:String>Int</sys:String>
                                <sys:String>Double</sys:String>
                                <sys:String>DateTime</sys:String>
                            </x:Array>
                        </DataGridComboBoxColumn.ItemsSource>
                    </DataGridComboBoxColumn>

                    <DataGridTextColumn Header="默认值" Binding="{Binding DefaultValue}" Width="80" />

                    <DataGridTemplateColumn Header="操作" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="删除"
                                        Background="#FFEEEE" Foreground="Red" BorderBrush="Red"
                                        Padding="5,0"
                                        Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
            <TextBlock Text="* 修改后请点击保存并重启" VerticalAlignment="Center" Foreground="Gray" Margin="0,0,10,0" />
            <Button Content="保存配置并重启" Command="{Binding SaveCommand}" Width="150" Height="35" Background="#DDDDDD" />
        </StackPanel>
    </Grid>
</Window>